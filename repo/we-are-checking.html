<!DOCTYPE html>
<html>
   <head>
      <style>
    .menu {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
      }

      .menu a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .menu a:hover {
        background-color: #f1f1f1;
      }

      div:hover .menu {
        display: block;
      }

      .package {
        position: relative;
        display: inline-block;
        padding: 12px 16px;
        margin: 8px;
        background-color: #ddd;
        border-radius: 4px;
      }

      .package:hover {
        background-color: #ccc;
      }
      </style>
      <title>Uckermark's Cydia Repo</title>
   </head>
   <body>
      <div>
         <div>Uckermark's Cydia Repo</div>
         <div>
            <a href="sileo://source/https://www.uckermark.tk/repo/"><b>Add repo to Sileo</b></a><span></span>
            <hr>
            <h4>These are the packages on this repo</h4>
  <div id="packageList"></div>

  <script>
    const response = await fetch('/Packages');
    const text = await response.text();

    class DebianPackage {
      constructor(data) {
        this.data = data;
      }

      getName() {
        return this.data.Package;
      }

      getVersion() {
        return this.data.Version;
      }

      toString() {
        return `${this.getName()} (${this.getVersion()})`;
      }
    }

    function parseDebPackageList(text) {
      const packages = [];
      const lines = text.split('\n');
      const data = {};
      for (const line of lines) {
        // If the line is blank, it marks the end of a package
        // so create a new DebianPackage object and add it to the list
        if (line.trim() === '') {
          packages.push(new DebianPackage(data));
          data = {};
          continue;
        }
        // Split the line on the first colon to get the key and value
        const [key, value] = line.split(':', 1);
        // Remove leading and trailing whitespace from the key and value
        const trimmedKey = key.trim();
        const trimmedValue = value.trim();
        // Add the key-value pair to the data object
        data[trimmedKey] = trimmedValue;
      }
      // Add the final package to the list
      packages.push(new DebianPackage(data));
      return packages;
    }

    // Example usage
    const packages = parseDebPackageList(text);
    const packageListElement = document.getElementById('packageList');
    for (const package of packages) {
      const packageElement = document.createElement('div');
      packageElement.classList.add('package');

      // Create the dropdown menu
      const menu = document.createElement('div');
      menu.classList.add('menu');

      // Create the depiction link
      const depictionLink = document.createElement('a');
      depictionLink.href = package.data.Depiction;
      depictionLink.textContent = 'View depiction';
      menu.appendChild(depictionLink);

      // Create the download link
      const downloadLink = document.createElement('a');
      downloadLink.href = package.data.Filename;
      downloadLink.textContent = 'Download package';
      menu.appendChild(downloadLink);

      // Add the dropdown menu to the package element
      packageElement.appendChild(menu);

      // Add the package name and version to the package element
      packageElement.textContent = package.toString();

      // Add the package element to the page
      packageListElement.appendChild(packageElement);
    }
  </script>
</body>
</html>
